(()=>{"use strict";var e={698:(e,s)=>{function n(e){return"object"!=typeof e?e:e.message?e.message:"unknown kondor error"}async function t(e){return new Promise((s=>setTimeout(s,e)))}Object.defineProperty(s,"__esModule",{value:!0}),s.Messenger=void 0;class o{constructor(e){if(this.listeners=[],this.onExtensionRequest=()=>Promise.resolve(),this.onDomRequest=()=>Promise.resolve(),e){if(e.onExtensionRequest){this.onExtensionRequest=e.onExtensionRequest;const s=async(e,s,n)=>{n();const{id:t,command:o}=e;if(!o)return;const r={id:t};try{const n=await this.onExtensionRequest(e,t,s);if("object"==typeof n&&null!==n&&n._derived)return;r.result=n}catch(e){r.error=e.message}(void 0!==r.result||r.error)&&this.sendResponse("extension",r,s)};this.listeners.push({type:"extension",id:"onRequest",listener:s}),chrome.runtime.onMessage.addListener(s)}if(e.onDomRequest){this.onDomRequest=e.onDomRequest;const s=async e=>{const{id:s,command:n}=e.data;if(!n)return;const t={id:s};try{const n=await this.onDomRequest(e,s);if("object"==typeof n&&null!==n&&n._derived)return;t.result=n}catch(e){t.error=e.message}(void 0!==t.result||t.error)&&this.sendResponse("dom",t)};this.listeners.push({type:"dom",id:"onRequest",listener:s}),window.addEventListener("message",s)}}}sendResponse(e,s,n){"dom"===e?window.postMessage(s,"*"):n&&n.tab?chrome.tabs.sendMessage(n.tab.id,s):chrome.runtime.sendMessage(s)}async sendDomMessage(e,s,t){const o=crypto.randomUUID();return new Promise(((r,i)=>{const a=e=>{if(e.data.command)return;const{id:s,result:t,error:a}=e.data;s===o&&(a?i(new Error(n(a))):r(t),this.removeListener(o))};this.listeners.push({type:"dom",id:o,listener:a}),window.addEventListener("message",a),window.postMessage({id:o,command:s,args:t?JSON.parse(JSON.stringify(t)):t,to:e},"*")}))}async sendExtensionMessage(e,s,o,r){const i=crypto.randomUUID();return new Promise(((a,d)=>{const c=(e,s,t)=>{if(t(),e.command)return;const{id:o,result:r,error:c}=e;o===i&&(c?d(new Error(n(c))):a(r),this.removeListener(i))};this.listeners.push({type:"extension",id:i,listener:c}),chrome.runtime.onMessage.addListener(c);const g=()=>{["popup","background"].includes(e)?chrome.runtime.sendMessage({id:i,command:s,args:o?JSON.parse(JSON.stringify(o)):o,to:e}):chrome.tabs.sendMessage(e,{id:i,command:s,args:o?JSON.parse(JSON.stringify(o)):o,to:e})};g(),r&&r.timeout&&setTimeout((()=>{d(new Error("Connection lost")),this.removeListener(i)}),r.timeout),r&&r.ping&&(async()=>{let s=(null==r?void 0:r.retries)||0;for(await t(1e3);this.listeners.find((e=>e.id===i));)try{await this.sendExtensionMessage(e,"ping",{id:i,to:e},{timeout:(null==r?void 0:r.pingTimeout)||80}),await t(1e3)}catch(e){if(s<=0){d(e),this.removeListener(i);break}s-=1,console.log(`retrying ${i}. remaining retries: ${s}`),g(),await t(100)}})().then((()=>{})).catch((e=>{console.log("ping error:"),console.log(e)}))}))}removeListener(e){const s=this.listeners.findIndex((s=>s.id===e));if(s<0)return;const n=this.listeners.splice(s,1),{listener:t,type:o}=n[0];"dom"===o?window.removeEventListener("message",t):chrome.runtime.onMessage.removeListener(t)}removeListeners(){this.listeners.forEach((e=>{const{type:s,listener:n}=e;"dom"===s?window.removeEventListener("message",n):chrome.runtime.onMessage.removeListener(n)})),this.listeners=[]}}s.default=o,s.Messenger=o},339:(e,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getAccounts=void 0;const t=new(n(698).Messenger);async function o(){return t.sendDomMessage("popup","getAccounts",{})}s.getAccounts=o,s.default=o},599:(e,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.provider=void 0;const t=new(n(698).Messenger)({});s.provider={call:async(e,s)=>t.sendDomMessage("background","provider:call",{method:e,params:s}),getNonce:async e=>t.sendDomMessage("background","provider:getNonce",{account:e}),getAccountRc:async e=>t.sendDomMessage("background","provider:getAccountRc",{account:e}),getTransactionsById:async e=>t.sendDomMessage("background","provider:getTransactionsById",{transactionIds:e}),getBlocksById:async e=>t.sendDomMessage("background","provider:getBlocksById",{blockIds:e}),getHeadInfo:async()=>t.sendDomMessage("background","provider:getHeadInfo"),getChainId:async()=>t.sendDomMessage("background","provider:getChainId"),getBlocks:async(e,s=1,n)=>t.sendDomMessage("background","provider:getBlocks",{height:e,numBlocks:s,idRef:n}),getBlock:async e=>t.sendDomMessage("background","provider:getBlock",{height:e}),wait:async(e,s="byBlock",n=3e4)=>t.sendDomMessage("background","provider:wait",{txId:e,type:s,timeout:n}),async sendTransaction(e,s=!0){const n=await t.sendDomMessage("background","provider:sendTransaction",{transaction:e,broadcast:s});return n.transaction.wait=async(e="byBlock",s=6e4)=>t.sendDomMessage("background","provider:wait",{txId:n.transaction.id,type:e,timeout:s}),n},submitBlock:async e=>t.sendDomMessage("background","provider:submitBlock",{block:e}),readContract:async e=>t.sendDomMessage("background","provider:readContract",{operation:e})},s.default=s.provider},942:(e,s,n)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getSigner=void 0;const t=new(n(698).Messenger)({});function o(e){return{getAddress:()=>e,getPrivateKey:()=>{throw new Error("getPrivateKey is not available")},signHash:s=>t.sendDomMessage("popup","signer:signHash",{signerAddress:e,hash:s}),signMessage:s=>t.sendDomMessage("popup","signer:signMessage",{signerAddress:e,message:s}),prepareTransaction:async s=>await t.sendDomMessage("background","signer:prepareTransaction",{signerAddress:e,transaction:s}),signTransaction:async(s,n)=>t.sendDomMessage("popup","signer:signTransaction",{signerAddress:e,transaction:s,abis:n}),sendTransaction:async(s,n)=>{const o=await t.sendDomMessage("popup","signer:sendTransaction",{signerAddress:e,transaction:s,optsSend:n});return o.transaction.wait=async(e="byBlock",s=6e4)=>t.sendDomMessage("background","provider:wait",{txId:o.transaction.id,type:e,timeout:s}),o},prepareBlock:()=>{throw new Error("prepareBlock is not available")},signBlock:()=>{throw new Error("signBlock is not available")}}}s.getSigner=o,s.default=o}},s={};function n(t){var o=s[t];if(void 0!==o)return o.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,n),r.exports}(()=>{const e=n(599),s=n(942),t=n(339);window.kondor={provider:e.provider,getSigner:s.getSigner,getAccounts:t.getAccounts}})()})();